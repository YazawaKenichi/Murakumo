回路設計時のノート

いろいろ悩みそうなところだけど、どこから悩めばいいのかもわからなかったので、まずはモータドライバ回路から設計しようと思う。

モータドライバ設計の前に、H ブリッジを駆動するためのゲートドライバ選びについて記述する。
##### ゲートドライバ
まず、ゲートドライバに必要な要素は以下の通り。
- Nch フルブリッジ回路を組むことができるか？
- 100% duty で出力できるか？
ということらしい。

###### Nch フルブリッジ回路
Nch フルブリッジ回路を組むことの利点は以下。
- Pch は Nch に比べて性能が低い。
- Pch は品種があまりない。
- パワー素子は一種類のみで済ませて手間を省きたい。（Pch か Nch にそろえて同じ素子を使って製作できるようにしたい。）
- Pch は値段が高い。
上記理由を先輩に教えていただいたが、教えていただいた後にネットを探したところ、同様の記述を発見した。[参考](http://blog.livedoor.jp/wata_net/archives/2147292.html)。
[こっちのサイト](https://qiita.com/panzakii/items/97eca16954d34ecf0c8b)には「なぜフルNchにこだわるかというと、単純にその方が流せる電流が大きくなるからです。実はPchFETはNchFETに比べ流せる電流が少ないのです。原理について説明しだすと本当にキリがないので説明しません。興味のある人はググってください。」などと記述されているが、ググってもそんな記述は一切出てこない。なんなんだ。

「品種が多いから Pch よりも大電流の流せる Nch MOSFET」ならわかるが、「原理」とか「説明しだすとキリがない」とか記述されているのは本当に意味が分からない。

###### 100% duty で出力
- 最大出力で出せたほうが良いにきまっとるやろ！

二つのメリットをカバーできて、より入手しやすい IC が A3921 だそうで、それが理由でよく利用される。
A3921 の仕様
ゲート電圧は基準電位から +15V 以内の範囲が出力される様子。具体的には、ハイサイド出力が SA の電位よりも 0 ~ 15V 高くなり、ローサイド出力が GND 電位よりも -5 ~ 16V 高くなるように出力される。

A3921 のデータシートを読んで得た情報
- GHA and GHB Pins
- ゲート抵抗はできるだけ FET に近いところに置く必要がある。（なんでや）
- ＞ そもそもゲート抵抗をつける理由として
- ＞＞ FET 内部のコンデンサ成分と、導線自体によるインダクタンス成分が共振し、それに影響して FET やマイコンが破損する恐れがある。
- ＞＞ ドレイン電圧の立ち上がりと立下りが早すぎてノイズへの影響が大きくなる。
- ＞＞ ゲート電流が大きすぎて FET 前段の制御回路が破損する。
- ＞ この中で FET と抵抗の距離と関係がありそうな理由としては「導線自体のインダクタンス」だろう。抵抗からFETまでの導線の長さを小さくする、すなわちインダクタンスを小さくすることでノイズを軽減するといったところか。
- いまいちよくわからないところが、「GHx going low turns on the lower half of the drive, sinking current from the external FET gate circuit to the corresponding Sx pin, turning off the FET.」の一文で、GHx を Low にしたらドライブの下半分が ON になる？ってどういうことだ？

参考になったサイト
- ハイサイド Nch MOSFET の話やブートストラップ回りについては[このサイト](https://techweb.rohm.co.jp/knowledge/dcdc/dcdc_sr/dcdc_sr01/829)が参考になった。

##### モータドライバ
ゲートドライバが決まったところで、次に使用する FET とそれにつながる制限抵抗やコンデンサの値を決める必要がある。
特にこの抵抗とコンデンサは真剣に決めないとショートしてリポが死ぬ。マジで。

###### Power MOSFET
FET の耐圧（D-S 間電圧）と流したいドレイン電流（ID 電流）で大体の規格が絞れる。
そこから、ON 抵抗とスイッチング速度から、損失の大きさを計算してそれに耐えるものを選ぶ。
DCX 10L 公称 4.5V の起動電流 1.55A で、これに 12V をかける。その時の電流値を考えて使う必要がある。
ついでに、配線幅については、右モータと左モータでひとつづつ使うことも考慮して設計する必要がある。

***書き途中***

##### CPU
先輩が STM32F405RGT6 を束買いしているので、とりあえずこれにするのはアリ。
クロック数とメモリと機能的に、ロボトレにいい塩梅で使えそうなのがこの CPU らしい。

***書き途中***

##### 電源回路
この電源回路を決めるのにレギュレータを選ぶ必要があるのだが、レギュレータの出力が決まらない以上は手の付けようがない。だからさっさとほかの回路作れ。電源選びは最後だ。
